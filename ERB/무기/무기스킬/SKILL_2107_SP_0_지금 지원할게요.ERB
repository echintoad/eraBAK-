;-----------------------------------
;기본치 계산에 앞서 처리하는 것
;-----------------------------------
@SKILL_2107_SP_0_EXIST
RETURN 1

@SKILL_2107_SP_0_NAME
RESULTS = 지, 지금 지원할게요!

;레벨은 1-5까지
@SKILL_2107_SP_0_LEVEL
RETURN 5

;대상 선택
@SKILL_2107_SP_0_SETTARGET(발동자, 발동번호, 발동측, 발동세력, 발동부대, 대상세력, 대상부대)
#DIM 발동자
#DIM 발동번호
#DIM 스킬
#DIMS 장르
#DIM 발동측
#DIM 발동세력
#DIM 발동부대
#DIM 대상측
#DIM 대상세력
#DIM 대상부대
대상측 = !발동측
;부대 대상
RETURN 1

;발동 판정
@SKILL_2107_SP_0_CAN_INVOKE(발동자, 발동번호, 발동측, 발동세력, 발동부대, 대상세력, 대상부대)
#DIM 발동자
#DIM 발동번호
#DIM 스킬
#DIMS 장르
#DIM 발동측
#DIM 발동세력
#DIM 발동부대
#DIM 대상측
#DIM 대상세력
#DIM 대상부대
대상측 = !발동측
RETURN 1

;발동 텍스트를 오바라이드 하고 싶을 때에.
;「아무개의 스킬 발동!   00했다!」의 「00했다!」의 부분을 실장하고 싶은 경우는,
;이것이 아니고 INVOKE로 쓰면 좋습니다.
;@SKILL_2107_SP_0_INVOKE_TEXT(발동자, 스킬, 장르)
;#DIM 발동자
;#DIM 스킬
;#DIMS 장르

;효과를 여기에 기술
@SKILL_2107_SP_0_INVOKE(발동자, 발동번호, 발동측, 발동세력, 발동부대, 대상세력, 대상부대)
#DIM 발동자
#DIM 발동번호
#DIM 스킬
#DIMS 장르
#DIM 발동측
#DIM 발동세력
#DIM 발동부대
#DIM 대상측
#DIM 대상세력
#DIM 대상부대
대상측 = !발동측
; PRINTFORML "여, 여러분... 지, 지원할게요!"
CALL DECREASE_SOLDIER(대상세력, 대상부대, RAND(ABL:발동자:무투*7, ABL:발동자:무투*10), 1)
BATTLE_RATE_ATC:대상측 += 10

@SKILL_2107_SP_0_EXPLANATION
RESULTS = 적 부대에 데미지를 주고 받는 데미지를 증가시킨다.


@SKILL_2107_SP_0_CANT_TELL

; 아이가 배울수 없도록 한다
@SKILL_2107_SP_0_CANT_INHERIT


@SKILL_2107_SP_0_RATE(발동자, 발동번호, 발동측, 발동세력, 발동부대, 대상세력, 대상부대)
#DIM 발동자
#DIM 발동번호
#DIM 스킬
#DIMS 장르
#DIM 발동측
#DIM 발동세력
#DIM 발동부대
#DIM 대상측
#DIM 대상세력
#DIM 대상부대
RETURN 500

; #region == 총력전 ==
@총력전_스킬_2107_코스트(시전자)
#DIM 시전자 ; 코스트 당 대미지 스킬 카운터 위해서
RETURN 3

@총력전_스킬_2107_설명(시전자)
#DIM 시전자 ; 가변스킬 설명 위해서
RESULTS = 적에게 공격력 331％ 대미지 이후 3턴간 적의 방어력 30％ 감소 아리우스 스쿼드가 2명 이상일 경우 감소량 51％로 증가. 시작시 팀에 자신 제외 아리우스 스쿼드 출신 학생당 명중률 증가 (학생수 x 20).

; 총력전 시작시 시전
; 스쿼드 멤버당 공격력 증가, 사오리는 치명 대미지로 변경
@총력전_스킬_2107_초기(시전자)
#DIM 시전자

#DIM DYNAMIC 스쿼드수
#DIM DYNAMIC 스쿼드번호 = 113, 114, 115, 116, 55
#DIM DYNAMIC 명중증가
#DIM DYNAMIC iTmp, 2
#DIMS DYNAMIC sTmp

; 스쿼드 학생 확인
FOR iTmp, 0, 총력전_캐릭터수
	iTmp:1 = 총력전_ID:iTmp
	; 없거나 시전자면 스킵
	SIF iTmp:1 < 0 || iTmp:1 == 시전자
		CONTINUE
	IF MATCH(스쿼드번호, NO:(iTmp:1))
		스쿼드수 ++
	ENDIF
NEXT
IF 스쿼드수 > 0
	명중증가 = 스쿼드수 * 20
	CALL 총력전_상태효과_추가(시전자, 시전자, 상효_종류_명중률백분율, 명중증가, 2, 총력전_방식_지속, 총력전_방식_지속, 1, 2107, 0)
	; 테스트 텍스트 추가
	sTmp = %총력전_이름:시전자%『아리우스 스쿼드』
	CALL 총력전_UI_텍스트_추가(sTmp, 칼라_노랑)
	sTmp = 명중률 증가 ({명중증가}％)
	CALL 총력전_UI_텍스트_추가(sTmp, 칼라_노랑)
	; UI 업데이트
	CALL 총력전_UI_Main(0)
	WAITANYKEY
ENDIF

@총력전_스킬_2107_발동(시전자)
#DIM 시전자

#DIM DYNAMIC 목표
#DIM DYNAMIC 대미지
#DIM DYNAMIC 방어감소
#DIM DYNAMIC 스쿼드수
#DIM DYNAMIC 스쿼드번호 = 113, 114, 115, 116, 55
#DIM DYNAMIC iTmp, 2
#DIMS DYNAMIC sTmp, 3

; 발동 텍스트
sTmp:0 = 「아, 엣…?! 자, 잠시만 기다려주세요!」
sTmp:1 = 「여, 여러분… 지, 지원할게요!」
sTmp:2 = 「이런 것도 인생이네요…」
CALL SKILL_2107_SP_0_NAME
CALL 총력전_스킬_공통_발동텍스트(시전자, 116, RESULTS, sTmp)
; 목표 처리
CALL 총력전_시퀀스_목표선택(목표, 총력전_선택_적군)
; 목표 없으면 스킬 해재
IF 목표 < 0
	CALL 총력전_스킬_공통_스킬취소(시전자)
	RETURN
ENDIF
; 대미지
대미지 = GETVAR_RAIDSTAT_SUM(시전자, "공격력") * 331
대미지 = DIVIDE_ROUND(대미지, 100)
CALL 총력전_처리_피격(대미지, 목표, 시전자)
; 명중시 방어감소
IF RESULT == 1
	; 스쿼드 학생 확인
	FOR iTmp, 0, 총력전_캐릭터수
		iTmp:1 = 총력전_ID:iTmp
		; 없거나 시전자면 스킵
		SIF iTmp:1 < 0 || iTmp == 시전자
			CONTINUE
		IF MATCH(스쿼드번호, NO:(iTmp:1))
			스쿼드수 ++
		ENDIF
	NEXT
	IF 스쿼드수 > 2
		방어감소 = -51
	ELSE
		방어감소 = -30
	ENDIF
	CALL 총력전_상태효과_추가_텍스트(목표, 시전자, 상효_종류_방어력백분율, 방어감소, 0, 총력전_방식_지속, 총력전_방식_턴, 3, 2107, 1)
ENDIF


; #DIM 방깎수치
; #DIM 대미지
; ;아리우스 스쿼드 찾기
; FOR COUNT, 0, 총력전_파티_캐릭터수
;     SIF 총력전_파티_캐릭터:COUNT == 113 || 총력전_파티_캐릭터:COUNT == 114 || 총력전_파티_캐릭터:COUNT == 115 || 총력전_파티_캐릭터:COUNT == 116
;     LOCAL:1 ++
; NEXT
; IF LOCAL:1 >= 2
;     방깎수치 = 51
; ELSE
;     방깎수치 = 30
; ENDIF
; 대미지 = (총력전_공격력:LOCAL * 331 / 100) * (100 - 총력전_보스_방어력) / 100
; CALL 공격판정처리(대미지,LOCAL)
; CALL 디버프부여처리("방깎",2107,3,LOCAL,방깎수치)